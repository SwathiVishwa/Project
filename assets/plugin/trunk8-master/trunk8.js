(function(d,c){if(typeof define==="function"&&define.amd){define(["jquery"],c)}else{if(typeof module==="object"&&module.exports){c(require("jquery"))}else{c(d.jQuery)}}}(this,function(r){var t,l,k={center:"center",left:"left",right:"right"},n={auto:"auto"};function s(a){this.$element=r(a);this.original_text=r.trim(this.$element.html());this.settings=r.extend({},r.fn.trunk8.defaults)}s.prototype.updateSettings=function(a){this.settings=r.extend(this.settings,a)};function q(a){var b=document.createElement("DIV");b.innerHTML=a;if(typeof b.textContent!="undefined"){return b.textContent}return b.innerText}function m(e){if(q(e)===e){return e.split(/\s/g)}var b=[],a=/<([a-z]+)([^<]*)(?:>([\S\s]*?(?!<\1>))<\/\1>|\s+\/>)(['.?!,]*)|((?:[^<>\s])+['.?!,]*\w?|<br\s?\/?>)/ig,d=a.exec(e),c,f;while(d&&c!==a.lastIndex){c=a.lastIndex;if(d[5]){b.push(d[5])}else{if(d[1]){b.push({tag:d[1],attribs:d[2],content:d[3],after:d[4]})}}d=a.exec(e)}for(f=0;f<b.length;f++){if(typeof b[f]!=="string"&&b[f].content){b[f].content=m(b[f].content)}}return b}function p(d,e,a){d=d.replace(a,"");var c=function(h,f){var g="",i,z,y,x,j;for(j=0;j<h.length;j++){i=h[j];y=r.trim(d).split(" ").length;if(r.trim(d).length){if(typeof i==="string"){if(!/<br\s*\/?>/i.test(i)){if(y===1&&r.trim(d).length<=i.length){i=d;if(f==="p"||f==="div"){i+=a}d=""}else{d=d.replace(i,"")}}g+=r.trim(i)+((j===h.length-1||y<=1)?"":" ")}else{z=c(i.content,i.tag);if(i.after){d=d.replace(i.after,"")}if(z){if(!i.after){i.after=" "}g+="<"+i.tag+i.attribs+">"+z+"</"+i.tag+">"+i.after}}}}return g},b=c(e);if(b.slice(b.length-a.length)!==a){b+=a}return b}function o(){var b=this.data("trunk8"),d=b.settings,h=d.width,E=d.side,i=d.fill,B=d.parseHTML,A=l.getLineHeight(this)*d.lines,D=b.original_text,g=D.length,f="",c,C,e,a,j,F;this.html(D);j=this.text();if(B&&q(D)!==D){F=m(D);D=q(D);g=D.length}if(h===n.auto){if(this.height()<=A){return}c=0;C=g-1;while(c<=C){e=c+((C-c)>>1);a=l.eatStr(D,E,g-e,i);if(B&&F){a=p(a,F,i)}this.html(a);if(this.height()>A){C=e-1}else{c=e+1;f=(f.length>a.length)?f:a}}this.html("");this.html(f);if(d.tooltip){this.attr("title",j)}}else{if(!isNaN(h)){e=g-h;a=l.eatStr(D,E,e,i);this.html(a);if(d.tooltip){this.attr("title",D)}}else{r.error('Invalid width "'+h+'".');return}}d.onTruncate()}t={init:function(a){return this.each(function(){var b=r(this),c=b.data("trunk8");if(!c){b.data("trunk8",(c=new s(this)))}c.updateSettings(a);o.call(b)})},update:function(a){return this.each(function(){var b=r(this);if(a){b.data("trunk8").original_text=a}o.call(b)})},revert:function(){return this.each(function(){var a=r(this).data("trunk8").original_text;r(this).html(a)})},getSettings:function(){return r(this.get(0)).data("trunk8").settings}};l={eatStr:function(d,h,a,e){var f=d.length,b=l.eatStr.generateKey.apply(null,arguments),c,g;if(l.eatStr.cache[b]){return l.eatStr.cache[b]}if((typeof d!=="string")||(f===0)){r.error('Invalid source string "'+d+'".')}if((a<0)||(a>f)){r.error('Invalid bite size "'+a+'".')}else{if(a===0){return d}}if(typeof(e+"")!=="string"){r.error("Fill unable to be converted to a string.")}switch(h){case k.right:return l.eatStr.cache[b]=r.trim(d.substr(0,f-a))+e;case k.left:return l.eatStr.cache[b]=e+r.trim(d.substr(a));case k.center:c=f>>1;g=a>>1;return l.eatStr.cache[b]=r.trim(l.eatStr(d.substr(0,f-c),k.right,a-g,""))+e+r.trim(l.eatStr(d.substr(f-c),k.left,g,""));default:r.error('Invalid side "'+h+'".')}},getLineHeight:function(a){var e=r(a).css("float");if(e!=="none"){r(a).css("float","none")}var d=r(a).css("position");if(d==="absolute"){r(a).css("position","static")}var c=r(a).html(),b="line-height-test",f;r(a).html("i").wrap('<div id="'+b+'" />');f=r("#"+b).innerHeight();r(a).html(c).css({"float":e,position:d}).unwrap();return f}};l.eatStr.cache={};l.eatStr.generateKey=function(){return Array.prototype.join.call(arguments,"")};r.fn.trunk8=function(a){if(t[a]){return t[a].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof a==="object"||!a){return t.init.apply(this,arguments)}else{r.error("Method "+a+" does not exist on jQuery.trunk8")}}};r.fn.trunk8.defaults={fill:"&hellip;",lines:1,side:k.right,tooltip:true,width:n.auto,parseHTML:false,onTruncate:function(){}}}));